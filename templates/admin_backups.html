{% extends "layout.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0"><i class="bi bi-tools me-2"></i>Admin Chain Tools</h3>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-speedometer"></i> Kembali ke Dashboard
    </a>
</div>

<div class="row g-4 mb-5">
    
    <div class="col-md-6 fade-in">
        <div class="card shadow-sm h-100 p-3">
            <h5 class="card-title fw-bold text-primary"><i class="bi bi-box-arrow-down me-2"></i>Export Chain</h5>
            <p class="card-text text-muted small">Download file `blockchain.json` saat ini. Berguna untuk audit atau backup manual.</p>
            <a href="{{ url_for('admin_export_chain') }}" class="btn btn-primary mt-auto w-100 py-2">
                <i class="bi bi-download"></i> Download Chain Sekarang
            </a>
        </div>
    </div>

    <div class="col-md-6 fade-in">
        <div class="card shadow-sm h-100 p-3">
            <h5 class="card-title fw-bold text-success"><i class="bi bi-box-arrow-up me-2"></i>Import Chain</h5>
            <p class="card-text text-muted small">Unggah file chain (`.json`) baru. Ini akan menimpa chain yang sedang berjalan setelah validasi integritas (admin-only).</p>
            <form method="POST" action="{{ url_for('admin_import_chain') }}" enctype="multipart/form-data" class="mt-auto">
                <div class="input-group">
                    <input type="file" name="file" class="form-control rounded-start-3" required accept=".json">
                    <button type="submit" class="btn btn-success rounded-end-3 py-2">
                        <i class="bi bi-upload"></i> Unggah & Terapkan
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

---

## ðŸ’¾ Daftar Auto-Backup (Restore Points)

<div class="card shadow-sm fade-in">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Nama File Backup</th>
                        <th>Waktu (Timestamp)</th>
                        <th class="text-end">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for filename in backups %}
                    <tr>
                        <td style="font-family: monospace;">{{ filename }}</td>
                        <td>{{ filename.split('_')[1].split('.')[0].replace('-', ' ') }}</td>
                        <td class="text-end">
                            <a href="{{ url_for('admin_download_backup', filename=filename) }}" class="btn btn-sm btn-outline-info me-2" target="_blank">
                                <i class="bi bi-file-earmark-arrow-down"></i> Download
                            </a>
                            <form method="POST" action="{{ url_for('admin_restore') }}" class="d-inline">
                                <input type="hidden" name="filename" value="{{ filename }}">
                                <button type="submit" class="btn btn-sm btn-warning" onclick="return confirm('APAKAH ANDA YAKIN? Ini akan menimpa chain saat ini. Pastikan Anda sudah mem-backup chain utama.')">
                                    <i class="bi bi-arrow-counterclockwise"></i> Restore
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="text-center text-muted">Tidak ada file backup.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<small class="text-muted mt-3 d-block">
    Note: File backup dibuat otomatis setiap kali ada transaksi baru/chain diubah. Daftar dibatasi (default 20 backup terbaru).
</small>

{% endblock %}